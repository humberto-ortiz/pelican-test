title: Intermediate Representation
date: 2015-04-14
category: Teaching
tags: hacking, learning
slug: teaching/compilers/intermediate

## Description

I have provided a parser for a subset of tiger that includes 

	exp:
		lvalue
		nil
		int
		string
		exp + exp
		exp - exp
		exp * exp
		exp / exp
		lvalue := exp
		id ( explist )
		let declist in exps end

	lvalue:
		# These are simple variables
		id

	declist:
		dec
		dec declist
		
	dec: 
		type typeid = typeid
		var id : typeid := exp
		function id ( typefields ) : typeid = exp

	exps:
		exp ; exps

	explist:
		exp
		exp , explist

	typefields:
		typefield
		typefield, typefields

	typefield:
		id : type-id
	
Your assignment is to augment your set of mutually recursive functions
that type check the abstract syntax tree generated by the parser to
also generate intermediate representation trees (in
`semant.sml`). Chapter 5 of the textbook describes the functions. The
sample code provides a few of the functions you should use. Chapter 6
shows how to allocate storage for local variables, and Chapter 7 how
to generate the intermediate representation trees.

We're going to stick to the simplest possible implementation, where
types and functions cannot be recursive, and all functions must have a
single argument and return a value.

Programs that typecheck correctly should return a list of Tree
structures. Programs that fail should return an appropriate error
message with ErrorMsg.error.

## Example code

The example code is in the [github][] repository. Look at the
`tiger/semant.sml` file.

[github]: https://github.com/humberto-ortiz/compilers-2015

You can parse and pretty print a sample program with functions using:

```
- CM.make "sources.cm";
- PrintAbsyn.print (TextIO.stdOut, Parse.parse "fun.tig");
LetExp([
 VarDec(a,true,SOME(int),
  IntExp(0)),
 FunctionDec[
  (foo,[
   (a,true,int)],
SOME(int),
   OpExp(PlusOp,
    VarExp(
     SimpleVar(a)),
    VarExp(
     SimpleVar(a))))]],
 SeqExp[
  AssignExp(
   SimpleVar(a),
   IntExp(43)),
  CallExp(foo,[
   CallExp(foo,[
    VarExp(
     SimpleVar(a))])])])
```

When you complete your assignment, `Semant.transProg` should produce a
list of program fragments. There's code to
[print trees](http://www.cs.princeton.edu/~appel/modern/ml/chap7/printtree.sml)
in the sample code for Chapter 7.

